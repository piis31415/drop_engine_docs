\chapter{cacheable-\/request}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf}{}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf}\index{cacheable-\/request@{cacheable-\/request}}
\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3072}%
\Hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3072}%


\begin{quote}
Wrap native HTTP requests with RFC compliant cache support \end{quote}
\href{https://travis-ci.org/lukechilds/cacheable-request}{\texttt{ }} \href{https://coveralls.io/github/lukechilds/cacheable-request?branch=master}{\texttt{ }} \href{https://www.npmjs.com/package/cacheable-request}{\texttt{ }} \href{https://www.npmjs.com/package/cacheable-request}{\texttt{ }}

\href{http://httpwg.org/specs/rfc7234.html}{\texttt{ RFC 7234}} compliant HTTP caching for native Node.\+js HTTP/\+HTTPS requests. Caching works out of the box in memory or is easily pluggable with a wide range of storage adapters.

{\bfseries{Note\+:}} This is a low level wrapper around the core HTTP modules, it\textquotesingle{}s not a high level request library.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3073}{}\doxysection{\texorpdfstring{Features}{Features}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3073}

\begin{DoxyItemize}
\item Only stores cacheable responses as defined by RFC 7234
\item Fresh cache entries are served directly from cache
\item Stale cache entries are revalidated with {\ttfamily If-\/\+None-\/\+Match}/{\ttfamily If-\/\+Modified-\/\+Since} headers
\item 304 responses from revalidation requests use cached body
\item Updates {\ttfamily Age} header on cached responses
\item Can completely bypass cache on a per request basis
\item In memory cache by default
\item Official support for Redis, Mongo\+DB, SQLite, Postgre\+SQL and My\+SQL storage adapters
\item Easily plug in your own or third-\/party storage adapters
\item If DB connection fails, cache is automatically bypassed (disabled by default)
\item Adds cache support to any existing HTTP code with minimal changes
\item Uses \href{https://github.com/pornel/http-cache-semantics}{\texttt{ http-\/cache-\/semantics}} internally for HTTP RFC 7234 compliance
\end{DoxyItemize}\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3074}{}\doxysection{\texorpdfstring{Install}{Install}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3074}

\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ cacheable-\/request}

\end{DoxyCode}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3075}{}\doxysection{\texorpdfstring{Usage}{Usage}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3075}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ http\ =\ require('http');}
\DoxyCodeLine{const\ CacheableRequest\ =\ require('cacheable-\/request');}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Then\ instead\ of}
\DoxyCodeLine{const\ req\ =\ http.request('http://example.com',\ cb);}
\DoxyCodeLine{req.end();}
\DoxyCodeLine{}
\DoxyCodeLine{//\ You\ can\ do}
\DoxyCodeLine{const\ cacheableRequest\ =\ new\ CacheableRequest(http.request);}
\DoxyCodeLine{const\ cacheReq\ =\ cacheableRequest('http://example.com',\ cb);}
\DoxyCodeLine{cacheReq.on('request',\ req\ =>\ req.end());}
\DoxyCodeLine{//\ Future\ requests\ to\ 'example.com'\ will\ be\ returned\ from\ cache\ if\ still\ valid}
\DoxyCodeLine{}
\DoxyCodeLine{//\ You\ pass\ in\ any\ other\ http.request\ API\ compatible\ method\ to\ be\ wrapped\ with\ cache\ support:}
\DoxyCodeLine{const\ cacheableRequest\ =\ new\ CacheableRequest(https.request);}
\DoxyCodeLine{const\ cacheableRequest\ =\ new\ CacheableRequest(electron.net);}

\end{DoxyCode}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3076}{}\doxysection{\texorpdfstring{Storage Adapters}{Storage Adapters}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3076}
{\ttfamily cacheable-\/request} uses \href{https://github.com/lukechilds/keyv}{\texttt{ Keyv}} to support a wide range of storage adapters.

For example, to use Redis as a cache backend, you just need to install the official Redis Keyv storage adapter\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ @keyv/redis}

\end{DoxyCode}


And then you can pass {\ttfamily Cacheable\+Request} your connection string\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ cacheableRequest\ =\ new\ CacheableRequest(http.request,\ 'redis://user:pass@localhost:6379');}

\end{DoxyCode}


\href{https://github.com/lukechilds/keyv\#official-storage-adapters}{\texttt{ View all official Keyv storage adapters.}}

Keyv also supports anything that follows the Map API so it\textquotesingle{}s easy to write your own storage adapter or use a third-\/party solution.

e.\+g The following are all valid storage adapters


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ storageAdapter\ =\ new\ Map();}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{const\ storageAdapter\ =\ require('./my-\/storage-\/adapter');}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{const\ QuickLRU\ =\ require('quick-\/lru');}
\DoxyCodeLine{const\ storageAdapter\ =\ new\ QuickLRU(\{\ maxSize:\ 1000\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{const\ cacheableRequest\ =\ new\ CacheableRequest(http.request,\ storageAdapter);}

\end{DoxyCode}


View the \href{https://github.com/lukechilds/keyv}{\texttt{ Keyv docs}} for more information on how to use storage adapters.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3077}{}\doxysection{\texorpdfstring{API}{API}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3077}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3078}{}\doxysubsection{\texorpdfstring{new cacheable\+Request(request, \mbox{[}storage\+Adapter\mbox{]})}{new cacheable\+Request(request, \mbox{[}storage\+Adapter\mbox{]})}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3078}
Returns the provided request function wrapped with cache support.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3079}{}\doxysubsubsection{\texorpdfstring{request}{request}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3079}
Type\+: {\ttfamily function}

Request function to wrap with cache support. Should be \href{https://nodejs.org/api/http.html\#http_http_request_options_callback}{\texttt{ {\ttfamily http.\+request}}} or a similar API compatible request function.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3080}{}\doxysubsubsection{\texorpdfstring{storage\+Adapter}{storage\+Adapter}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3080}
Type\+: {\ttfamily Keyv storage adapter}~\newline
 Default\+: {\ttfamily new Map()}

A \href{https://github.com/lukechilds/keyv}{\texttt{ Keyv}} storage adapter instance, or connection string if using with an official Keyv storage adapter.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3081}{}\doxysubsection{\texorpdfstring{Instance}{Instance}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3081}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3082}{}\doxysubsubsection{\texorpdfstring{cacheable\+Request(opts, \mbox{[}cb\mbox{]})}{cacheable\+Request(opts, \mbox{[}cb\mbox{]})}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3082}
Returns an event emitter.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3083}{}\doxysubsubsubsection{\texorpdfstring{opts}{opts}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3083}
Type\+: {\ttfamily object}, {\ttfamily string}


\begin{DoxyItemize}
\item Any of the default request functions options.
\item Any \href{https://github.com/kornelski/http-cache-semantics\#constructor-options}{\texttt{ {\ttfamily http-\/cache-\/semantics}}} options.
\item Any of the following\+:
\end{DoxyItemize}\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3084}{}\doxysubsubsubsubsection{\texorpdfstring{opts.\+cache}{opts.\+cache}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3084}
Type\+: {\ttfamily boolean}~\newline
 Default\+: {\ttfamily true}

If the cache should be used. Setting this to false will completely bypass the cache for the current request.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3085}{}\doxysubsubsubsubsection{\texorpdfstring{opts.\+strict\+Ttl}{opts.\+strict\+Ttl}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3085}
Type\+: {\ttfamily boolean}~\newline
 Default\+: {\ttfamily false}

If set to {\ttfamily true} once a cached resource has expired it is deleted and will have to be re-\/requested.

If set to {\ttfamily false} (default), after a cached resource\textquotesingle{}s TTL expires it is kept in the cache and will be revalidated on the next request with {\ttfamily If-\/\+None-\/\+Match}/{\ttfamily If-\/\+Modified-\/\+Since} headers.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3086}{}\doxysubsubsubsubsection{\texorpdfstring{opts.\+max\+Ttl}{opts.\+max\+Ttl}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3086}
Type\+: {\ttfamily number}~\newline
 Default\+: {\ttfamily undefined}

Limits TTL. The {\ttfamily number} represents milliseconds.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3087}{}\doxysubsubsubsubsection{\texorpdfstring{opts.\+automatic\+Failover}{opts.\+automatic\+Failover}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3087}
Type\+: {\ttfamily boolean}~\newline
 Default\+: {\ttfamily false}

When set to {\ttfamily true}, if the DB connection fails we will automatically fallback to a network request. DB errors will still be emitted to notify you of the problem even though the request callback may succeed.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3088}{}\doxysubsubsubsubsection{\texorpdfstring{opts.\+force\+Refresh}{opts.\+force\+Refresh}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3088}
Type\+: {\ttfamily boolean}~\newline
 Default\+: {\ttfamily false}

Forces refreshing the cache. If the response could be retrieved from the cache, it will perform a new request and override the cache instead.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3089}{}\doxysubsubsubsection{\texorpdfstring{cb}{cb}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3089}
Type\+: {\ttfamily function}

The callback function which will receive the response as an argument.

The response can be either a \href{https://nodejs.org/api/http.html\#http_class_http_incomingmessage}{\texttt{ Node.\+js HTTP response stream}} or a \href{https://github.com/lukechilds/responselike}{\texttt{ responselike object}}. The response will also have a {\ttfamily from\+Cache} property set with a boolean value.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3090}{}\doxysubsubsubsection{\texorpdfstring{.on(\textquotesingle{}request\textquotesingle{}, request)}{.on(\textquotesingle{}request\textquotesingle{}, request)}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3090}
{\ttfamily request} event to get the request object of the request.

{\bfseries{Note\+:}} This event will only fire if an HTTP request is actually made, not when a response is retrieved from cache. However, you should always handle the {\ttfamily request} event to end the request and handle any potential request errors.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3091}{}\doxysubsubsubsection{\texorpdfstring{.on(\textquotesingle{}response\textquotesingle{}, response)}{.on(\textquotesingle{}response\textquotesingle{}, response)}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3091}
{\ttfamily response} event to get the response object from the HTTP request or cache.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3092}{}\doxysubsubsubsection{\texorpdfstring{.on(\textquotesingle{}error\textquotesingle{}, error)}{.on(\textquotesingle{}error\textquotesingle{}, error)}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3092}
{\ttfamily error} event emitted in case of an error with the cache.

Errors emitted here will be an instance of {\ttfamily Cacheable\+Request.\+Request\+Error} or {\ttfamily Cacheable\+Request.\+Cache\+Error}. You will only ever receive a {\ttfamily Request\+Error} if the request function throws (normally caused by invalid user input). Normal request errors should be handled inside the {\ttfamily request} event.

To properly handle all error scenarios you should use the following pattern\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{cacheableRequest('example.com',\ cb)}
\DoxyCodeLine{\ \ .on('error',\ err\ =>\ \{}
\DoxyCodeLine{\ \ \ \ if\ (err\ instanceof\ CacheableRequest.CacheError)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ handleCacheError(err);\ //\ Cache\ error}
\DoxyCodeLine{\ \ \ \ \}\ else\ if\ (err\ instanceof\ CacheableRequest.RequestError)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ handleRequestError(err);\ //\ Request\ function\ thrown}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .on('request',\ req\ =>\ \{}
\DoxyCodeLine{\ \ \ \ req.on('error',\ handleRequestError);\ //\ Request\ error\ emitted}
\DoxyCodeLine{\ \ \ \ req.end();}
\DoxyCodeLine{\ \ \});}

\end{DoxyCode}


{\bfseries{Note\+:}} Database connection errors are emitted here, however {\ttfamily cacheable-\/request} will attempt to re-\/request the resource and bypass the cache on a connection error. Therefore a database connection error doesn\textquotesingle{}t necessarily mean the request won\textquotesingle{}t be fulfilled.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3093}{}\doxysection{\texorpdfstring{License}{License}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2ee374e56ffb8ce1dc7cc507ab8bd8dcf_autotoc_md3093}
MIT © Luke Childs 