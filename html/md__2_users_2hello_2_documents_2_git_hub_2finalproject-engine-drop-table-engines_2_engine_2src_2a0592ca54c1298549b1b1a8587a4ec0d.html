<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: p-cancelable</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">p-cancelable</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8585"></a></p>
<blockquote class="doxtable">
<p>&zwj;Create a promise that can be canceled </p>
</blockquote>
<p>Useful for animation, loading resources, long-running async computations, async iteration, etc.</p>
<p>*If you target <a href="https://medium.com/@nodejs/node-js-v15-0-0-is-here-deb00750f278">Node.js 15</a> or later, this package is <a href="https://github.com/sindresorhus/p-cancelable/issues/27">less useful</a> and you should probably use <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController"><code>AbortController</code></a> instead.*</p>
<h1><a class="anchor" id="autotoc_md8586"></a>
Install</h1>
<div class="fragment"><div class="line">$ npm install p-cancelable</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8587"></a>
Usage</h1>
<div class="fragment"><div class="line">const PCancelable = require(&#39;p-cancelable&#39;);</div>
<div class="line"> </div>
<div class="line">const cancelablePromise = new PCancelable((resolve, reject, onCancel) =&gt; {</div>
<div class="line">    const worker = new SomeLongRunningOperation();</div>
<div class="line"> </div>
<div class="line">    onCancel(() =&gt; {</div>
<div class="line">        worker.close();</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    worker.on(&#39;finish&#39;, resolve);</div>
<div class="line">    worker.on(&#39;error&#39;, reject);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    try {</div>
<div class="line">        console.log(&#39;Operation finished successfully:&#39;, await cancelablePromise);</div>
<div class="line">    } catch (error) {</div>
<div class="line">        if (cancelablePromise.isCanceled) {</div>
<div class="line">            // Handle the cancelation here</div>
<div class="line">            console.log(&#39;Operation was canceled&#39;);</div>
<div class="line">            return;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        throw error;</div>
<div class="line">    }</div>
<div class="line">})();</div>
<div class="line"> </div>
<div class="line">// Cancel the operation after 10 seconds</div>
<div class="line">setTimeout(() =&gt; {</div>
<div class="line">    cancelablePromise.cancel(&#39;Unicorn has changed its color&#39;);</div>
<div class="line">}, 10000);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8588"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md8589"></a>
new PCancelable(executor)</h2>
<p>Same as the <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code> constructor</a>, but with an appended <code>onCancel</code> parameter in <code>executor</code>.<br  />
 Cancelling will reject the promise with <code>PCancelable.CancelError</code>. To avoid that, set <code>onCancel.shouldReject</code> to <code>false</code>.</p>
<div class="fragment"><div class="line">const PCancelable = require(&#39;p-cancelable&#39;);</div>
<div class="line"> </div>
<div class="line">const cancelablePromise = new PCancelable((resolve, reject, onCancel) =&gt; {</div>
<div class="line">    const job = new Job();</div>
<div class="line"> </div>
<div class="line">    onCancel.shouldReject = false;</div>
<div class="line">    onCancel(() =&gt; {</div>
<div class="line">        job.stop();</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    job.on(&#39;finish&#39;, resolve);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">cancelablePromise.cancel(); // Doesn&#39;t throw an error</div>
</div><!-- fragment --><p><code>PCancelable</code> is a subclass of <code>Promise</code>.</p>
<h3><a class="anchor" id="autotoc_md8590"></a>
onCanceled(fn)</h3>
<p>Type: <code>Function</code></p>
<p>Accepts a function that is called when the promise is canceled.</p>
<p>You're not required to call this function. You can call this function multiple times to add multiple cancel handlers.</p>
<h2><a class="anchor" id="autotoc_md8591"></a>
PCancelable#cancel(reason?)</h2>
<p>Type: <code>Function</code></p>
<p>Cancel the promise and optionally provide a reason.</p>
<p>The cancellation is synchronous. Calling it after the promise has settled or multiple times does nothing.</p>
<h2><a class="anchor" id="autotoc_md8592"></a>
PCancelable#isCanceled</h2>
<p>Type: <code>boolean</code></p>
<p>Whether the promise is canceled.</p>
<h2><a class="anchor" id="autotoc_md8593"></a>
PCancelable.CancelError</h2>
<p>Type: <code>Error</code></p>
<p>Rejection reason when <code>.cancel()</code> is called.</p>
<p>It includes a <code>.isCanceled</code> property for convenience.</p>
<h2><a class="anchor" id="autotoc_md8594"></a>
PCancelable.fn(fn)</h2>
<p>Convenience method to make your promise-returning or async function cancelable.</p>
<p>The function you specify will have <code>onCancel</code> appended to its parameters.</p>
<div class="fragment"><div class="line">const PCancelable = require(&#39;p-cancelable&#39;);</div>
<div class="line"> </div>
<div class="line">const fn = PCancelable.fn((input, onCancel) =&gt; {</div>
<div class="line">    const job = new Job();</div>
<div class="line"> </div>
<div class="line">    onCancel(() =&gt; {</div>
<div class="line">        job.cleanup();</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    return job.start(); //=&gt; Promise</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">const cancelablePromise = fn(&#39;input&#39;); //=&gt; PCancelable</div>
<div class="line"> </div>
<div class="line">// …</div>
<div class="line"> </div>
<div class="line">cancelablePromise.cancel();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8595"></a>
FAQ</h1>
<h2><a class="anchor" id="autotoc_md8596"></a>
Cancelable vs. Cancellable</h2>
<p><a href="http://grammarist.com/spelling/cancel/">In American English, the verb cancel is usually inflected canceled and canceling—with one l.</a><br  />
Both a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/cancelable">browser API</a> and the <a href="https://github.com/tc39/proposal-cancelable-promises">Cancelable Promises proposal</a> use this spelling.</p>
<h2><a class="anchor" id="autotoc_md8597"></a>
What about the official <a href="https://github.com/tc39/proposal-cancelable-promises">Cancelable Promises proposal</a>?</h2>
<p><strike>It's still an early draft and I don't really like its current direction. It complicates everything and will require deep changes in the ecosystem to adapt to it. And the way you have to use cancel tokens is verbose and convoluted. I much prefer the more pragmatic and less invasive approach in this module.</strike> The proposal was withdrawn.</p>
<h1><a class="anchor" id="autotoc_md8598"></a>
p-cancelable for enterprise</h1>
<p>Available as part of the Tidelift Subscription.</p>
<p>The maintainers of p-cancelable and thousands of other packages are working with Tidelift to deliver commercial support and maintenance for the open source dependencies you use to build your applications. Save time, reduce risk, and improve code health, while paying the maintainers of the exact dependencies you use. <a href="https://tidelift.com/subscription/pkg/npm-p-cancelable?utm_source=npm-p-cancelable&amp;utm_medium=referral&amp;utm_campaign=enterprise&amp;utm_term=repo">Learn more.</a></p>
<h1><a class="anchor" id="autotoc_md8599"></a>
Related</h1>
<ul>
<li><a href="https://github.com/sindresorhus/p-progress">p-progress</a> - Create a promise that reports progress</li>
<li><a href="https://github.com/sindresorhus/p-lazy">p-lazy</a> - Create a lazy promise that defers execution until <code>.then()</code> or <code>.catch()</code> is called</li>
<li><a href="https://github.com/sindresorhus/promise-fun">More…</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
