<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: cacheable-lookup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">cacheable-lookup</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md3040"></a></p>
<blockquote class="doxtable">
<p>&zwj;A cacheable <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback"><code>dns.lookup(…)</code></a> that respects TTL :tada: </p>
</blockquote>
<p><a href="https://github.com/szmarczak/cacheable-lookup/actions"><img src="https://github.com/szmarczak/cacheable-lookup/workflows/Node%20CI/badge.svg" alt="Node CI" style="pointer-events: none;" class="inline"/></a> <a href="https://coveralls.io/github/szmarczak/cacheable-lookup?branch=master"><img src="https://coveralls.io/repos/github/szmarczak/cacheable-lookup/badge.svg?branch=master" alt="Coverage Status" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/cacheable-lookup"><img src="https://img.shields.io/npm/dm/cacheable-lookup.svg" alt="npm" style="pointer-events: none;" class="inline"/></a> <a href="https://packagephobia.now.sh/result?p=cacheable-lookup"><img src="https://packagephobia.now.sh/badge?p=cacheable-lookup" alt="install size" class="inline"/></a></p>
<p>Making lots of HTTP requests? You can save some time by caching DNS lookups :zap:</p>
<h1><a class="anchor" id="autotoc_md3041"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md3042"></a>
Using the <code>lookup</code> option</h2>
<div class="fragment"><div class="line">const http = require(&#39;http&#39;);</div>
<div class="line">const CacheableLookup = require(&#39;cacheable-lookup&#39;);</div>
<div class="line"> </div>
<div class="line">const cacheable = new CacheableLookup();</div>
<div class="line"> </div>
<div class="line">http.get(&#39;http://example.com&#39;, {lookup: cacheable.lookup}, response =&gt; {</div>
<div class="line">    // Handle the response here</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3043"></a>
Attaching CacheableLookup to an Agent</h2>
<div class="fragment"><div class="line">const http = require(&#39;http&#39;);</div>
<div class="line">const CacheableLookup = require(&#39;cacheable-lookup&#39;);</div>
<div class="line"> </div>
<div class="line">const cacheable = new CacheableLookup();</div>
<div class="line">cacheable.install(http.globalAgent);</div>
<div class="line"> </div>
<div class="line">http.get(&#39;http://example.com&#39;, response =&gt; {</div>
<div class="line">    // Handle the response here</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3044"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md3045"></a>
new CacheableLookup(options)</h2>
<p>Returns a new instance of <code>CacheableLookup</code>.</p>
<h3><a class="anchor" id="autotoc_md3046"></a>
options</h3>
<p>Type: <code>object</code><br  />
 Default: <code>{}</code></p>
<p>Options used to cache the DNS lookups.</p>
<h4><a class="anchor" id="autotoc_md3047"></a>
cache</h4>
<p>Type: <code>Map</code> | <a href="https://github.com/lukechilds/keyv/"><code>Keyv</code></a><br  />
 Default: <code>new Map()</code></p>
<p>Custom cache instance. If <code>undefined</code>, it will create a new one.</p>
<p><b>Note</b>: If you decide to use Keyv instead of the native implementation, the performance will drop by 10x. Memory leaks may occur as it doesn't provide any way to remove all the deprecated values at once.</p>
<p><b>Tip</b>: <a href="https://github.com/sindresorhus/quick-lru"><code>QuickLRU</code></a> is fully compatible with the Map API, you can use it to limit the amount of cached entries. Example:</p>
<div class="fragment"><div class="line">const http = require(&#39;http&#39;);</div>
<div class="line">const CacheableLookup = require(&#39;cacheable-lookup&#39;);</div>
<div class="line">const QuickLRU = require(&#39;quick-lru&#39;);</div>
<div class="line"> </div>
<div class="line">const cacheable = new CacheableLookup({</div>
<div class="line">    cache: new QuickLRU({maxSize: 1000})</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">http.get(&#39;http://example.com&#39;, {lookup: cacheable.lookup}, response =&gt; {</div>
<div class="line">    // Handle the response here</div>
<div class="line">});</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md3048"></a>
options.maxTtl</h4>
<p>Type: <code>number</code><br  />
 Default: <code>Infinity</code></p>
<p>The maximum lifetime of the entries received from the specifed DNS server (TTL in seconds).</p>
<p>If set to <code>0</code>, it will make a new DNS query each time.</p>
<p><b>Pro Tip</b>: This shouldn't be lower than your DNS server response time in order to prevent bottlenecks. For example, if you use Cloudflare, this value should be greater than <code>0.01</code>.</p>
<h4><a class="anchor" id="autotoc_md3049"></a>
options.fallbackDuration</h4>
<p>Type: <code>number</code><br  />
 Default: <code>3600</code> (1 hour)</p>
<p>When the DNS server responds with <code>ENOTFOUND</code> or <code>ENODATA</code> and the OS reports that the entry is available, it will use <code>dns.lookup(...)</code> directly for the requested hostnames for the specified amount of time (in seconds).</p>
<p>If you don't query internal hostnames (such as <code>localhost</code>, <code>database.local</code> etc.), it is strongly recommended to set this value to <code>0</code>.</p>
<h4><a class="anchor" id="autotoc_md3050"></a>
options.errorTtl</h4>
<p>Type: <code>number</code><br  />
 Default: <code>0.15</code></p>
<p>The time how long it needs to remember queries that threw <code>ENOTFOUND</code> or <code>ENODATA</code> (TTL in seconds).</p>
<p><b>Note</b>: This option is independent, <code>options.maxTtl</code> does not affect this.</p>
<p><b>Pro Tip</b>: This shouldn't be lower than your DNS server response time in order to prevent bottlenecks. For example, if you use Cloudflare, this value should be greater than <code>0.01</code>.</p>
<h4><a class="anchor" id="autotoc_md3051"></a>
options.resolver</h4>
<p>Type: <code>dns.Resolver | dns.promises.Resolver</code><br  />
 Default: <a href="https://nodejs.org/api/dns.html#dns_class_dns_resolver"><code>new dns.promises.Resolver()</code></a></p>
<p>An instance of <a href="https://nodejs.org/api/dns.html#dns_class_dns_resolver">DNS Resolver</a> used to make DNS queries.</p>
<h4><a class="anchor" id="autotoc_md3052"></a>
options.lookup</h4>
<p>Type: <code>Function</code><br  />
 Default: <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback"><code>dns.lookup</code></a></p>
<p>The fallback function to use when the DNS server responds with <code>ENOTFOUND</code> or <code>ENODATA</code>.</p>
<p><b>Note</b>: This has no effect if the <code>fallbackDuration</code> option is less than <code>1</code>.</p>
<h2><a class="anchor" id="autotoc_md3053"></a>
Entry object</h2>
<p>Type: <code>object</code></p>
<h3><a class="anchor" id="autotoc_md3054"></a>
address</h3>
<p>Type: <code>string</code></p>
<p>The IP address (can be an IPv4 or IPv6 address).</p>
<h3><a class="anchor" id="autotoc_md3055"></a>
family</h3>
<p>Type: <code>number</code></p>
<p>The IP family (<code>4</code> or <code>6</code>).</p>
<h4><a class="anchor" id="autotoc_md3056"></a>
expires</h4>
<p>Type: <code>number</code></p>
<p><b>Note</b>: This is not present when falling back to <code>dns.lookup(...)</code>!</p>
<p>The timestamp (<code>Date.now() + ttl * 1000</code>) when the entry expires.</p>
<h3><a class="anchor" id="autotoc_md3057"></a>
ttl</h3>
<p><b>Note</b>: This is not present when falling back to <code>dns.lookup(...)</code>!</p>
<p>The time in seconds for its lifetime.</p>
<h2><a class="anchor" id="autotoc_md3058"></a>
Entry object (callback-style)</h2>
<p>When <code>options.all</code> is <code>false</code>, then <code>callback(error, address, family, expires, ttl)</code> is called. <br  />
 When <code>options.all</code> is <code>true</code>, then <code>callback(error, entries)</code> is called.</p>
<h2><a class="anchor" id="autotoc_md3059"></a>
CacheableLookup instance</h2>
<h3><a class="anchor" id="autotoc_md3060"></a>
servers</h3>
<p>Type: <code>Array</code></p>
<p>The DNS servers used to make queries. Can be overridden - doing so will clear the cache.</p>
<h3><a class="anchor" id="autotoc_md3061"></a>
<a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback">lookup(hostname, options, callback)</a></h3>
<h3><a class="anchor" id="autotoc_md3062"></a>
lookupAsync(hostname, options)</h3>
<p>The asynchronous version of <code>dns.lookup(…)</code>.</p>
<p>Returns an entry object.<br  />
 If <code>options.all</code> is true, returns an array of entry objects.</p>
<h4><a class="anchor" id="autotoc_md3063"></a>
hostname</h4>
<p>Type: <code>string</code></p>
<h4><a class="anchor" id="autotoc_md3064"></a>
options</h4>
<p>Type: <code>object</code></p>
<p>The same as the <a href="https://nodejs.org/api/dns.html#dns_dns_lookup_hostname_options_callback"><code>dns.lookup(…)</code></a> options.</p>
<h3><a class="anchor" id="autotoc_md3065"></a>
query(hostname)</h3>
<p>An asynchronous function which returns cached DNS lookup entries.<br  />
 This is the base for <code>lookupAsync(hostname, options)</code> and <code>lookup(hostname, options, callback)</code>.</p>
<p><b>Note</b>: This function has no options.</p>
<p>Returns an array of objects with <code>address</code>, <code>family</code>, <code>ttl</code> and <code>expires</code> properties.</p>
<h3><a class="anchor" id="autotoc_md3066"></a>
queryAndCache(hostname)</h3>
<p>An asynchronous function which makes two DNS queries: A and AAAA. The result is cached.<br  />
 This is used by <code>query(hostname)</code> if no entry in the database is present.</p>
<p>Returns an array of objects with <code>address</code>, <code>family</code>, <code>ttl</code> and <code>expires</code> properties.</p>
<h3><a class="anchor" id="autotoc_md3067"></a>
updateInterfaceInfo()</h3>
<p>Updates interface info. For example, you need to run this when you plug or unplug your WiFi driver.</p>
<p><b>Note:</b> Running <code>updateInterfaceInfo()</code> will trigger <code>clear()</code> only on network interface removal.</p>
<h3><a class="anchor" id="autotoc_md3068"></a>
clear(hostname?)</h3>
<p>Clears the cache for the given hostname. If the hostname argument is not present, the entire cache will be emptied.</p>
<h1><a class="anchor" id="autotoc_md3069"></a>
High performance</h1>
<p>Performed on:</p><ul>
<li>Query: <code>example.com</code></li>
<li>CPU: i7-7700k</li>
<li>CPU governor: performance</li>
</ul>
<div class="fragment"><div class="line">CacheableLookup#lookupAsync                x 2,896,251 ops/sec ±1.07% (85 runs sampled)</div>
<div class="line">CacheableLookup#lookupAsync.all            x 2,842,664 ops/sec ±1.11% (88 runs sampled)</div>
<div class="line">CacheableLookup#lookupAsync.all.ADDRCONFIG x 2,598,283 ops/sec ±1.21% (88 runs sampled)</div>
<div class="line">CacheableLookup#lookup                     x 2,565,913 ops/sec ±1.56% (85 runs sampled)</div>
<div class="line">CacheableLookup#lookup.all                 x 2,609,039 ops/sec ±1.01% (86 runs sampled)</div>
<div class="line">CacheableLookup#lookup.all.ADDRCONFIG      x 2,416,242 ops/sec ±0.89% (85 runs sampled)</div>
<div class="line">dns#lookup                                 x 7,272     ops/sec ±0.36% (86 runs sampled)</div>
<div class="line">dns#lookup.all                             x 7,249     ops/sec ±0.40% (86 runs sampled)</div>
<div class="line">dns#lookup.all.ADDRCONFIG                  x 5,693     ops/sec ±0.28% (85 runs sampled)</div>
<div class="line">Fastest is CacheableLookup#lookupAsync.all</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3070"></a>
Related</h1>
<ul>
<li><a href="https://github.com/lukechilds/cacheable-request">cacheable-request</a> - Wrap native HTTP requests with RFC compliant cache support</li>
</ul>
<h1><a class="anchor" id="autotoc_md3071"></a>
License</h1>
<p>MIT </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
