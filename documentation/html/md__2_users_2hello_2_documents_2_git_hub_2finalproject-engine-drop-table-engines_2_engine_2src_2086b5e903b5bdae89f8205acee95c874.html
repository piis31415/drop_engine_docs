<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: @malept/flatpak-bundler &lt;a href=&quot;https://www.npmjs.com/package/@malept/flatpak-bundler&quot; &gt;&lt;img src=&quot;https://img.shields.io/npm/v/@malept/flatpak-bundler.svg&quot; alt=&quot;Version&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/malept/flatpak-bundler/actions?query=workflow%3ACI&quot; &gt;&lt;img src=&quot;https://github.com/malept/flatpak-bundler/workflows/CI/badge.svg&quot; alt=&quot;Build Status&quot;/&gt;&lt;/a&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">@malept/flatpak-bundler &lt;a href="https://www.npmjs.com/package/@malept/flatpak-bundler" &gt;&lt;img src="https://img.shields.io/npm/v/@malept/flatpak-bundler.svg" alt="Version"/&gt;&lt;/a&gt; &lt;a href="https://github.com/malept/flatpak-bundler/actions?query=workflow%3ACI" &gt;&lt;img src="https://github.com/malept/flatpak-bundler/workflows/CI/badge.svg" alt="Build Status"/&gt;&lt;/a&gt;</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1187"></a></p>
<p>Build <a href="https://flatpak.org/">flatpaks</a> from Node.js.</p>
<h1><a class="anchor" id="autotoc_md1188"></a>
Quick Start</h1>
<p>Install <code>@malept/flatpak-bundler</code>. </p><div class="fragment"><div class="line">$ npm install @malept/flatpak-bundler</div>
</div><!-- fragment --><p>Build a flatpak with a Node script.</p>
<p>Install and run it! </p><div class="fragment"><div class="line">$ flatpak install --user --bundle hello.flatpak</div>
<div class="line">$ flatpak run org.world.Hello</div>
<div class="line">Hello, world!</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1189"></a>
Overview</h2>
<p>This modules allows building flatpaks programmatically from Node. It requires Node 10 or above and flatpak &gt;= 0.6.13 to be installed on your system.</p>
<p>Under the hood, this is just a wrapper for the <a href="https://docs.flatpak.org/en/latest/flatpak-builder.html">flatpak-builder</a> tool with some extra sugar added.</p>
<p>With <code>flatpak-builder</code>, you specify a runtime, sandbox permissions and software modules to build into your application, and build a flatpak from start to finish. This module provides a few additional features:</p>
<ul>
<li>Supports auto installing flatpak runtime and app dependencies</li>
<li>Supports exporting directly to the a single file flatpak bundle</li>
<li>Supports easy copying files and creating symlinks directly in <code>/app</code></li>
</ul>
<p>The latter is particularly useful for <a href="https://electronjs.org/">Electron</a> and <a href="http://nwjs.io/">nw.js</a> style Node applications, which often create packages from prebuilt binaries and do not attempt to follow an autotools-like <a href="https://github.com/cgwalters/build-api">build api</a>.</p>
<p>This module should make it easy to plug flatpak support into an Electron or nw.js app packaging phase.</p>
<h2><a class="anchor" id="autotoc_md1190"></a>
Usage</h2>
<h3><a class="anchor" id="autotoc_md1191"></a>
translateArch(arch)</h3>
<p>Used to translate a Node-style arch (e.g., <code>x64</code>) into a Flatpak-compatible arch (e.g., <code>x86_64</code>).</p>
<p>If the arch is unknown, it will pass through the input value.</p>
<h3><a class="anchor" id="autotoc_md1192"></a>
bundle(manifest, buildOptions)</h3>
<p>Takes an app manifest and a build options object. It returns a Promise.</p>
<p>Both the manifest and options objects support both camelCase and dash-separated variants of any option.</p>
<p>The promise is returned with a <code>finalBuildOptions</code> value. It contains the build options after default values have been applied. Useful to read out the <code>workingDir</code>, for example.</p>
<h4><a class="anchor" id="autotoc_md1193"></a>
Manifest</h4>
<p>This matches the format for <a href="https://docs.flatpak.org/en/latest/manifests.html"><code>flatpak-builder</code> app manifests</a>, with a few extra options added and camelCase variants supported.</p>
<ul>
<li><b>id</b>: Required. The application id.</li>
<li><b>runtime</b>: Required. The runtime for your flatpak application.</li>
<li><b>sdk</b>: Required. The sdk for your flatpak application.</li>
<li><b>base</b>: An app to inherit from. Use the app as a "base" for <code>/app</code> contents.</li>
<li><b>finishArgs</b>: The arguments to pass to <code>flatpak build-finish</code>. Use this to add sandbox permissions. See the Electron app example for some common app permissions.</li>
<li><b>modules</b>: If you need to build other software modules into you flatpak app (anything not already in your runtime or base app), you can specify them here.</li>
</ul>
<h4><a class="anchor" id="autotoc_md1194"></a>
Build Options</h4>
<ul>
<li><b>bundlePath</b>: Output location for a single file version of the flatpak. If non supplied, the single file flatpak will not be created.</li>
<li><b>arch</b>: The architecture for the flatpak bundle. x86_64, i386 or arm.</li>
<li><b>workingDir</b>: The working directory to call <code>flatpak-builder</code> from. Defaults to a new tmp directory.</li>
<li><b>buildDir</b>: The directory to build the application in. Defaults to <code>${workingDir}/build</code></li>
<li><b>repoDir</b>: The directory for a flatpak repo, can be used to publish to an existing repo. Defaults to <code>${workingDir}/repo</code></li>
<li><b>cleanTmpdirs</b>: Cleanup any tmp directories created during the build on process exit. Defaults to true. Set false for easier debugging.</li>
<li><b>autoInstallRuntime</b>: Install/update the runtime while building. Defaults to true if runtimeFlatpakref is set in the manifest.</li>
<li><b>autoInstallSdk</b>: Install/update the sdk while building. Defaults to true if sdkFlatpakref is set in the manifest.</li>
<li><b>autoInstallBase</b>: Install/update the base app while building. Defaults to true if baseFlatpakref is set in the manifest.</li>
<li><b>gpgSign</b>: The gpg key to use to sign the flatpak repo and bundle file.</li>
<li><b>gpgHomedir</b>: The gpg homedir to use when signing.</li>
<li><b>subject</b>: The single line subject to use for the flatpak repo commit message.</li>
<li><b>body</b>: The description to use for the flatpak repo commit message.</li>
<li><b>files</b>: Files to copy directly into the app. Should be a list of [source, dest] tuples. Source should be a relative/absolute path to a file/directory to copy into the flatpak, and dest should be the path inside the app install prefix (e.g. <code>/share/applications/</code>)</li>
<li><b>symlinks</b>: Symlinks to create in the app files. Should be a list of [target, location] symlink tuples. Target can be either a relative or absolute path inside the app install prefix, and location should be a absolute path inside the prefix to create the symlink at.</li>
<li><b>extraExports</b>: Files to export outside of the flatpak sandbox, in addition to the application desktop file, icons and appstream. File basename <em>must</em> be prefixed with the app id. Should not be needed for common use.</li>
<li><b>runtimeFlatpakref</b>: A pathname or url to a flatpakref file to use to auto install the runtime.</li>
<li><b>sdkFlatpakref</b>: A pathname or url to a flatpakref file to use to auto install the sdk.</li>
<li><b>baseFlatpakref</b>: A pathname or url to a flatpakref file to use to auto install the base app.</li>
<li><b>bundleRepoUrl</b>: Repo url for the single file bundle. Installing the bundle will automatically configure a remote for this URL.</li>
<li><b>extraFlatpakBuilderArgs</b>: List of extra arguments to pass to the <a href="https://docs.flatpak.org/en/latest/flatpak-builder-command-reference.html">flatpak-builder</a> command.</li>
<li><b>extraFlatpakBuildExportArgs</b>: List of extra arguments to pass to the <a href="https://docs.flatpak.org/en/latest/flatpak-command-reference.html#flatpak-build-export">flatpak build-export</a> command.</li>
<li><b>extraFlatpakBuildBundleArgs</b>: List of extra arguments to pass to the <a href="https://docs.flatpak.org/en/latest/flatpak-command-reference.html#flatpak-build-bundle">flatpak build-bundle</a> command.</li>
</ul>
<h3><a class="anchor" id="autotoc_md1195"></a>
Logging</h3>
<p>To turn on debugging output, set the DEBUG environment variable:</p>
<div class="fragment"><div class="line">DEBUG=flatpak-bundler npm run my-flatpak-command</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1196"></a>
Examples</h2>
<h3><a class="anchor" id="autotoc_md1197"></a>
Hello world</h3>
<div class="fragment"><div class="line">const flatpakBundler = require(&#39;@malept/flatpak-bundler&#39;)</div>
<div class="line">const fs = require(&#39;fs-extra&#39;)</div>
<div class="line"> </div>
<div class="line">// Write a hello world script to disk</div>
<div class="line">await fs.writeFile(&#39;hello&#39;,</div>
<div class="line">`#!/bin/bash</div>
<div class="line">echo &quot;Hello, world!&quot;`, { mode: 0o755 })</div>
<div class="line"> </div>
<div class="line">// Make a flatpak with it!</div>
<div class="line">try {</div>
<div class="line">  await flatpakBundler.bundle({</div>
<div class="line">    id: &#39;org.world.Hello&#39;,</div>
<div class="line">    runtime: &#39;org.freedesktop.Platform&#39;,</div>
<div class="line">    runtimeVersion: &#39;1.4&#39;,</div>
<div class="line">    sdk: &#39;org.freedesktop.Sdk&#39;,</div>
<div class="line">  }, {</div>
<div class="line">    bundlePath: &#39;hello.flatpak&#39;,</div>
<div class="line">    files: [</div>
<div class="line">      [&#39;hello&#39;, &#39;/bin/hello&#39;]</div>
<div class="line">    ],</div>
<div class="line">    runtimeFlatpakref: &#39;https://raw.githubusercontent.com/endlessm/flatpak-bundler/master/refs/freedesktop-runtime-1.4.flatpakref&#39;</div>
<div class="line">  })</div>
<div class="line">  console.log(&#39;Flatpak built successfully&#39;)</div>
<div class="line">} catch (error) {</div>
<div class="line">    console.error(&#39;Error building flatpak&#39;, error)</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1198"></a>
Electron App</h3>
<div class="fragment"><div class="line">const flatpakBundler = require(&#39;@malept/flatpak-bundler&#39;)</div>
<div class="line"> </div>
<div class="line">try {</div>
<div class="line">  const finalBuildOptions = await flatpakBundler.bundle({ // Manifest</div>
<div class="line">    id: &#39;org.world.Hello&#39;,</div>
<div class="line">    base: &#39;io.atom.electron.BaseApp&#39;, // Electron base application</div>
<div class="line">    runtime: &#39;org.freedesktop.Platform&#39;, // Use the freedesktop runtime</div>
<div class="line">    runtimeVersion: &#39;1.4&#39;,</div>
<div class="line">    sdk: &#39;org.freedesktop.Sdk&#39;,</div>
<div class="line">    finishArgs: [</div>
<div class="line">      &#39;--share=ipc&#39;, &#39;--socket=x11&#39;, // Allow app to show windows with X11</div>
<div class="line">      &#39;--socket=pulseaudio&#39;, // Allow audio output</div>
<div class="line">      &#39;--filesystem=home&#39;, // Allow access to users home directory</div>
<div class="line">      &#39;--share=network&#39;, // Allow network access</div>
<div class="line">      &#39;--device=dri&#39; // Allow OpenGL rendering</div>
<div class="line">    ],</div>
<div class="line">    renameDesktopFile: &#39;hello.desktop&#39;, // Rename the desktop file to agree with the app ID so flatpak will export it</div>
<div class="line">    renameIcon: &#39;hello&#39; // Rename the icon to agree with the app ID so flatpak will export it</div>
<div class="line">  }, { // Build options</div>
<div class="line">    arch: &#39;x86_64&#39;,</div>
<div class="line">    baseFlatpakref: &#39;https://s3-us-west-2.amazonaws.com/electron-flatpak.endlessm.com/electron-base-app-master.flatpakref&#39;, // So we can auto install the runtime</div>
<div class="line">    bundlePath: &#39;dist/hello_x86_64.flatpak&#39;,</div>
<div class="line">    files: [</div>
<div class="line">      [ &#39;static/linux&#39;, &#39;/share/&#39; ], // Desktop file and icons</div>
<div class="line">      [ packagedFileDir, &#39;/share/bar&#39; ] // Application binaries and assets</div>
<div class="line">    ],</div>
<div class="line">    gpgSign: &#39;1234ABCD&#39;, // GPG key to sign with</div>
<div class="line">    runtimeFlatpakref: &#39;https://raw.githubusercontent.com/endlessm/flatpak-bundler/master/refs/freedesktop-runtime-1.4.flatpakref&#39;,</div>
<div class="line">    symlinks: [</div>
<div class="line">      [ &#39;/share/bar/Bar&#39;, &#39;/bin/Bar&#39; ] // Create a symlink in /bin to to app executable</div>
<div class="line">    ]</div>
<div class="line">  })</div>
<div class="line">  console.log(&#39;Flatpak built successfully.&#39;)</div>
<div class="line">  console.log(`Build dir and repo in ${finalBuildOptions.workingDir}`)</div>
<div class="line">} catch (error) {</div>
<div class="line">  console.error(&#39;Error building flatpak&#39;, error)</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
