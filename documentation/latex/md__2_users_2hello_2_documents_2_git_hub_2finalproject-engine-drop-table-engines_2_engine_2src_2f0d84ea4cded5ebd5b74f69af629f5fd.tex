\chapter{async-\/exit-\/hook}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd}{}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd}\index{async-\/exit-\/hook@{async-\/exit-\/hook}}
\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2496}%
\Hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2496}%


\href{https://travis-ci.org/Tapppi/async-exit-hook}{\texttt{ }} \href{https://coveralls.io/github/Tapppi/async-exit-hook?branch=master}{\texttt{ }}

\begin{quote}
Run some code when the process exits \end{quote}
The `process.\+on(\textquotesingle{}exit')\`{} event doesn\textquotesingle{}t catch all the ways a process can exit. This module catches\+:


\begin{DoxyItemize}
\item process SIGINT, SIGTERM and SIGHUP, SIGBREAK signals ~\newline

\item process before\+Exit and exit events ~\newline

\item PM2 clustering process shutdown message (\href{http://pm2.keymetrics.io/docs/usage/cluster-mode/\#graceful-reload}{\texttt{ PM2 graceful reload}}) ~\newline

\end{DoxyItemize}

Useful for cleaning up. You can also include async handlers, and add custom events to hook and exit on.

Forked and pretty much rewritten from \href{https://npmjs.com/package/exit-hook}{\texttt{ exit-\/hook}}.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2497}{}\doxysection{\texorpdfstring{Install}{Install}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2497}

\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ install\ -\/-\/save\ async-\/exit-\/hook}

\end{DoxyCode}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2498}{}\doxysection{\texorpdfstring{Usage}{Usage}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2498}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2499}{}\doxysubsection{\texorpdfstring{Considerations and warning}{Considerations and warning}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2499}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2500}{}\doxysubsubsection{\texorpdfstring{On {\ttfamily process.\+exit()} and asynchronous code}{On {\ttfamily process.\+exit()} and asynchronous code}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2500}
{\bfseries{If you use asynchronous exit hooks, DO NOT use {\ttfamily process.\+exit()} to exit. The {\ttfamily exit} event DOES NOT support asynchronous code.}} \texorpdfstring{$>$}{>}\mbox{[}\textquotesingle{}before\+Exit\textquotesingle{} is not emitted for conditions causing explicit termination, such as process.\+exit()\mbox{]} (\href{https://nodejs.org/api/process.html\#process_event_beforeexit}{\texttt{ https\+://nodejs.\+org/api/process.\+html\#process\+\_\+event\+\_\+beforeexit}})\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2501}{}\doxysubsubsection{\texorpdfstring{Windows and {\ttfamily process.\+kill(signal)}}{Windows and {\ttfamily process.\+kill(signal)}}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2501}
On windows {\ttfamily process.\+kill(signal)} immediately kills the process, and does not fire signal events, and as such, cannot be used to gracefully exit. See {\itshape Clustering and child processes} for a workaround when killing child processes. I\textquotesingle{}m planning to support gracefully exiting with async support on windows soon.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2502}{}\doxysubsection{\texorpdfstring{Clustering and child processes}{Clustering and child processes}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2502}
If you use custom clustering / child processes, you can gracefully shutdown your child process by sending a shutdown message (`child\+Proc.\+send(\textquotesingle{}shutdown')\`{}).\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2503}{}\doxysubsection{\texorpdfstring{Example}{Example}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2503}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ exitHook\ =\ require('async-\/exit-\/hook');}
\DoxyCodeLine{}
\DoxyCodeLine{exitHook(()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ console.log('exiting');}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ you\ can\ add\ multiple\ hooks,\ even\ across\ files}
\DoxyCodeLine{exitHook(()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ console.log('exiting\ 2');}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ you\ can\ add\ async\ hooks\ by\ accepting\ a\ callback}
\DoxyCodeLine{exitHook(callback\ =>\ \{}
\DoxyCodeLine{\ \ \ \ setTimeout(()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ console.log('exiting\ 3');}
\DoxyCodeLine{\ \ \ \ \ \ \ \ callback();}
\DoxyCodeLine{\ \ \ \ \},\ 1000);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ You\ can\ hook\ uncaught\ errors\ with\ uncaughtExceptionHandler(),\ consequently\ adding\ }
\DoxyCodeLine{//\ async\ support\ to\ uncaught\ errors\ (normally\ uncaught\ errors\ result\ in\ a\ synchronous\ exit).}
\DoxyCodeLine{exitHook.uncaughtExceptionHandler(err\ =>\ \{}
\DoxyCodeLine{\ \ \ \ console.error(err);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ You\ can\ hook\ unhandled\ rejections\ with\ unhandledRejectionHandler()}
\DoxyCodeLine{exitHook.unhandledRejectionHandler(err\ =>\ \{}
\DoxyCodeLine{\ \ \ \ console.error(err);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ You\ can\ add\ multiple\ uncaught\ error\ handlers}
\DoxyCodeLine{//\ Add\ the\ second\ parameter\ (callback)\ to\ indicate\ async\ hooks}
\DoxyCodeLine{exitHook.uncaughtExceptionHandler((err,\ callback)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ sendErrorToCloudOrWhatever(err)\ //\ Returns\ promise}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .then(()\ =>\ \{\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ console.log('Sent\ err\ to\ cloud');\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .catch(sendError\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ console.error('Error\ sending\ to\ cloud:\ ',\ err.stack));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{\ \ \ \ \ \ \ \ .then(()\ =>\ callback);}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Add\ exit\ hooks\ for\ a\ signal\ or\ custom\ message:}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Custom\ signal}
\DoxyCodeLine{//\ Arguments\ are\ \`{}signal,\ exitCode`\ (SIGBREAK\ is\ already\ handled,\ this\ is\ an\ example)}
\DoxyCodeLine{exitHook.hookEvent('SIGBREAK',\ 21);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ process\ event:\ \`{}message`\ with\ a\ filter}
\DoxyCodeLine{//\ filter\ gets\ all\ arguments\ passed\ to\ *handler*:\ \`{}process.on(message,\ *handler*)`}
\DoxyCodeLine{//\ Exits\ on\ process\ event\ \`{}message`\ with\ msg\ \`{}customShutdownMessage`\ only}
\DoxyCodeLine{exitHook.hookEvent('message',\ 0,\ msg\ =>\ msg\ !==\ 'customShutdownMessage');}
\DoxyCodeLine{}
\DoxyCodeLine{//\ All\ async\ hooks\ will\ work\ with\ uncaught\ errors\ when\ you\ have\ specified\ an\ uncaughtExceptionHandler}
\DoxyCodeLine{throw\ new\ Error('awesome');}
\DoxyCodeLine{}
\DoxyCodeLine{//=>\ //\ Sync\ uncaughtExcpetion\ hooks\ called\ and\ retun}
\DoxyCodeLine{//=>\ '[Error:\ awesome]'}
\DoxyCodeLine{//=>\ //\ Sync\ hooks\ called\ and\ retun}
\DoxyCodeLine{//=>\ 'exiting'}
\DoxyCodeLine{//=>\ 'exiting\ 2'}
\DoxyCodeLine{//=>\ //\ Async\ uncaughtException\ hooks\ return}
\DoxyCodeLine{//=>\ 'Sent\ error\ to\ cloud'}
\DoxyCodeLine{//=>\ //\ Sync\ uncaughtException\ hooks\ return}
\DoxyCodeLine{//=>\ 'exiting\ 3'}

\end{DoxyCode}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2504}{}\doxysection{\texorpdfstring{License}{License}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2f0d84ea4cded5ebd5b74f69af629f5fd_autotoc_md2504}
MIT © Tapani Moilanen ~\newline
 MIT © \href{http://sindresorhus.com}{\texttt{ Sindre Sorhus}} 