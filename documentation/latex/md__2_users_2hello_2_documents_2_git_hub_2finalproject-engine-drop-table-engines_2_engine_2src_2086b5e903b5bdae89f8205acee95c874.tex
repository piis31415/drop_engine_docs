\chapter{@malept/flatpak-\/bundler \texorpdfstring{$<$}{<}a href="{}https\+://www.\+npmjs.\+com/package/@malept/flatpak-\/bundler"{} \texorpdfstring{$>$}{>}\texorpdfstring{$<$}{<}img src="{}https\+://img.\+shields.\+io/npm/v/@malept/flatpak-\/bundler.\+svg"{} alt="{}\+Version"{}/\texorpdfstring{$>$}{>}\texorpdfstring{$<$}{<}/a\texorpdfstring{$>$}{>} \texorpdfstring{$<$}{<}a href="{}https\+://github.\+com/malept/flatpak-\/bundler/actions?query=workflow\%3\+ACI"{} \texorpdfstring{$>$}{>}\texorpdfstring{$<$}{<}img src="{}https\+://github.\+com/malept/flatpak-\/bundler/workflows/\+CI/badge.\+svg"{} alt="{}\+Build Status"{}/\texorpdfstring{$>$}{>}\texorpdfstring{$<$}{<}/a\texorpdfstring{$>$}{>}}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874}{}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874}\index{"@malept/flatpak-\/bundler $<$a href="{}https://www.npmjs.com/package/"@malept/flatpak-\/bundler"{} $>$$<$img src="{}https://img.shields.io/npm/v/"@malept/flatpak-\/bundler.svg"{} alt="{}Version"{}/$>$$<$/a$>$ $<$a href="{}https://github.com/malept/flatpak-\/bundler/actions?query=workflow\%3ACI"{} $>$$<$img src="{}https://github.com/malept/flatpak-\/bundler/workflows/CI/badge.svg"{} alt="{}Build Status"{}/$>$$<$/a$>$@{"@malept/flatpak-\/bundler $<$a href=""https://www.npmjs.com/package/"@malept/flatpak-\/bundler"" $>$$<$img src=""https://img.shields.io/npm/v/"@malept/flatpak-\/bundler.svg"" alt=""Version""/$>$$<$/a$>$ $<$a href=""https://github.com/malept/flatpak-\/bundler/actions?query=workflow\%3ACI"" $>$$<$img src=""https://github.com/malept/flatpak-\/bundler/workflows/CI/badge.svg"" alt=""Build Status""/$>$$<$/a$>$}}
\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1187}%
\Hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1187}%


Build \href{https://flatpak.org/}{\texttt{ flatpaks}} from Node.\+js.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1188}{}\doxysection{\texorpdfstring{Quick Start}{Quick Start}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1188}
Install {\ttfamily @malept/flatpak-\/bundler}. 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ install\ @malept/flatpak-\/bundler}

\end{DoxyCode}


Build a flatpak with a Node script.

Install and run it! 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ flatpak\ install\ -\/-\/user\ -\/-\/bundle\ hello.flatpak}
\DoxyCodeLine{\$\ flatpak\ run\ org.world.Hello}
\DoxyCodeLine{Hello,\ world!}

\end{DoxyCode}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1189}{}\doxysubsection{\texorpdfstring{Overview}{Overview}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1189}
This modules allows building flatpaks programmatically from Node. It requires Node 10 or above and flatpak \texorpdfstring{$>$}{>}= 0.\+6.\+13 to be installed on your system.

Under the hood, this is just a wrapper for the \href{https://docs.flatpak.org/en/latest/flatpak-builder.html}{\texttt{ flatpak-\/builder}} tool with some extra sugar added.

With {\ttfamily flatpak-\/builder}, you specify a runtime, sandbox permissions and software modules to build into your application, and build a flatpak from start to finish. This module provides a few additional features\+:


\begin{DoxyItemize}
\item Supports auto installing flatpak runtime and app dependencies
\item Supports exporting directly to the a single file flatpak bundle
\item Supports easy copying files and creating symlinks directly in {\ttfamily /app}
\end{DoxyItemize}

The latter is particularly useful for \href{https://electronjs.org/}{\texttt{ Electron}} and \href{http://nwjs.io/}{\texttt{ nw.\+js}} style Node applications, which often create packages from prebuilt binaries and do not attempt to follow an autotools-\/like \href{https://github.com/cgwalters/build-api}{\texttt{ build api}}.

This module should make it easy to plug flatpak support into an Electron or nw.\+js app packaging phase.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1190}{}\doxysubsection{\texorpdfstring{Usage}{Usage}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1190}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1191}{}\doxysubsubsection{\texorpdfstring{translate\+Arch(arch)}{translate\+Arch(arch)}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1191}
Used to translate a Node-\/style arch (e.\+g., {\ttfamily x64}) into a Flatpak-\/compatible arch (e.\+g., {\ttfamily x86\+\_\+64}).

If the arch is unknown, it will pass through the input value.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1192}{}\doxysubsubsection{\texorpdfstring{bundle(manifest, build\+Options)}{bundle(manifest, build\+Options)}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1192}
Takes an app manifest and a build options object. It returns a Promise.

Both the manifest and options objects support both camel\+Case and dash-\/separated variants of any option.

The promise is returned with a {\ttfamily final\+Build\+Options} value. It contains the build options after default values have been applied. Useful to read out the {\ttfamily working\+Dir}, for example.\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1193}{}\doxysubsubsubsection{\texorpdfstring{Manifest}{Manifest}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1193}
This matches the format for \href{https://docs.flatpak.org/en/latest/manifests.html}{\texttt{ {\ttfamily flatpak-\/builder} app manifests}}, with a few extra options added and camel\+Case variants supported.


\begin{DoxyItemize}
\item {\bfseries{id}}\+: Required. The application id.
\item {\bfseries{runtime}}\+: Required. The runtime for your flatpak application.
\item {\bfseries{sdk}}\+: Required. The sdk for your flatpak application.
\item {\bfseries{base}}\+: An app to inherit from. Use the app as a "{}base"{} for {\ttfamily /app} contents.
\item {\bfseries{finish\+Args}}\+: The arguments to pass to {\ttfamily flatpak build-\/finish}. Use this to add sandbox permissions. See the Electron app example for some common app permissions.
\item {\bfseries{modules}}\+: If you need to build other software modules into you flatpak app (anything not already in your runtime or base app), you can specify them here.
\end{DoxyItemize}\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1194}{}\doxysubsubsubsection{\texorpdfstring{Build Options}{Build Options}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1194}

\begin{DoxyItemize}
\item {\bfseries{bundle\+Path}}\+: Output location for a single file version of the flatpak. If non supplied, the single file flatpak will not be created.
\item {\bfseries{arch}}\+: The architecture for the flatpak bundle. x86\+\_\+64, i386 or arm.
\item {\bfseries{working\+Dir}}\+: The working directory to call {\ttfamily flatpak-\/builder} from. Defaults to a new tmp directory.
\item {\bfseries{build\+Dir}}\+: The directory to build the application in. Defaults to {\ttfamily \$\{working\+Dir\}/build}
\item {\bfseries{repo\+Dir}}\+: The directory for a flatpak repo, can be used to publish to an existing repo. Defaults to {\ttfamily \$\{working\+Dir\}/repo}
\item {\bfseries{clean\+Tmpdirs}}\+: Cleanup any tmp directories created during the build on process exit. Defaults to true. Set false for easier debugging.
\item {\bfseries{auto\+Install\+Runtime}}\+: Install/update the runtime while building. Defaults to true if runtime\+Flatpakref is set in the manifest.
\item {\bfseries{auto\+Install\+Sdk}}\+: Install/update the sdk while building. Defaults to true if sdk\+Flatpakref is set in the manifest.
\item {\bfseries{auto\+Install\+Base}}\+: Install/update the base app while building. Defaults to true if base\+Flatpakref is set in the manifest.
\item {\bfseries{gpg\+Sign}}\+: The gpg key to use to sign the flatpak repo and bundle file.
\item {\bfseries{gpg\+Homedir}}\+: The gpg homedir to use when signing.
\item {\bfseries{subject}}\+: The single line subject to use for the flatpak repo commit message.
\item {\bfseries{body}}\+: The description to use for the flatpak repo commit message.
\item {\bfseries{files}}\+: Files to copy directly into the app. Should be a list of \mbox{[}source, dest\mbox{]} tuples. Source should be a relative/absolute path to a file/directory to copy into the flatpak, and dest should be the path inside the app install prefix (e.\+g. {\ttfamily /share/applications/})
\item {\bfseries{symlinks}}\+: Symlinks to create in the app files. Should be a list of \mbox{[}target, location\mbox{]} symlink tuples. Target can be either a relative or absolute path inside the app install prefix, and location should be a absolute path inside the prefix to create the symlink at.
\item {\bfseries{extra\+Exports}}\+: Files to export outside of the flatpak sandbox, in addition to the application desktop file, icons and appstream. File basename {\itshape must} be prefixed with the app id. Should not be needed for common use.
\item {\bfseries{runtime\+Flatpakref}}\+: A pathname or url to a flatpakref file to use to auto install the runtime.
\item {\bfseries{sdk\+Flatpakref}}\+: A pathname or url to a flatpakref file to use to auto install the sdk.
\item {\bfseries{base\+Flatpakref}}\+: A pathname or url to a flatpakref file to use to auto install the base app.
\item {\bfseries{bundle\+Repo\+Url}}\+: Repo url for the single file bundle. Installing the bundle will automatically configure a remote for this URL.
\item {\bfseries{extra\+Flatpak\+Builder\+Args}}\+: List of extra arguments to pass to the \href{https://docs.flatpak.org/en/latest/flatpak-builder-command-reference.html}{\texttt{ flatpak-\/builder}} command.
\item {\bfseries{extra\+Flatpak\+Build\+Export\+Args}}\+: List of extra arguments to pass to the \href{https://docs.flatpak.org/en/latest/flatpak-command-reference.html\#flatpak-build-export}{\texttt{ flatpak build-\/export}} command.
\item {\bfseries{extra\+Flatpak\+Build\+Bundle\+Args}}\+: List of extra arguments to pass to the \href{https://docs.flatpak.org/en/latest/flatpak-command-reference.html\#flatpak-build-bundle}{\texttt{ flatpak build-\/bundle}} command.
\end{DoxyItemize}\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1195}{}\doxysubsubsection{\texorpdfstring{Logging}{Logging}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1195}
To turn on debugging output, set the DEBUG environment variable\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{DEBUG=flatpak-\/bundler\ npm\ run\ my-\/flatpak-\/command}

\end{DoxyCode}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1196}{}\doxysubsection{\texorpdfstring{Examples}{Examples}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1196}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1197}{}\doxysubsubsection{\texorpdfstring{Hello world}{Hello world}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1197}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ flatpakBundler\ =\ require('@malept/flatpak-\/bundler')}
\DoxyCodeLine{const\ fs\ =\ require('fs-\/extra')}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Write\ a\ hello\ world\ script\ to\ disk}
\DoxyCodeLine{await\ fs.writeFile('hello',}
\DoxyCodeLine{\`{}\#!/bin/bash}
\DoxyCodeLine{echo\ "{}Hello,\ world!"{}`,\ \{\ mode:\ 0o755\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Make\ a\ flatpak\ with\ it!}
\DoxyCodeLine{try\ \{}
\DoxyCodeLine{\ \ await\ flatpakBundler.bundle(\{}
\DoxyCodeLine{\ \ \ \ id:\ 'org.world.Hello',}
\DoxyCodeLine{\ \ \ \ runtime:\ 'org.freedesktop.Platform',}
\DoxyCodeLine{\ \ \ \ runtimeVersion:\ '1.4',}
\DoxyCodeLine{\ \ \ \ sdk:\ 'org.freedesktop.Sdk',}
\DoxyCodeLine{\ \ \},\ \{}
\DoxyCodeLine{\ \ \ \ bundlePath:\ 'hello.flatpak',}
\DoxyCodeLine{\ \ \ \ files:\ [}
\DoxyCodeLine{\ \ \ \ \ \ ['hello',\ '/bin/hello']}
\DoxyCodeLine{\ \ \ \ ],}
\DoxyCodeLine{\ \ \ \ runtimeFlatpakref:\ 'https://raw.githubusercontent.com/endlessm/flatpak-\/bundler/master/refs/freedesktop-\/runtime-\/1.4.flatpakref'}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ console.log('Flatpak\ built\ successfully')}
\DoxyCodeLine{\}\ catch\ (error)\ \{}
\DoxyCodeLine{\ \ \ \ console.error('Error\ building\ flatpak',\ error)}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1198}{}\doxysubsubsection{\texorpdfstring{Electron App}{Electron App}}\label{md__2_users_2hello_2_documents_2_git_hub_2finalproject-engine-drop-table-engines_2_engine_2src_2086b5e903b5bdae89f8205acee95c874_autotoc_md1198}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ flatpakBundler\ =\ require('@malept/flatpak-\/bundler')}
\DoxyCodeLine{}
\DoxyCodeLine{try\ \{}
\DoxyCodeLine{\ \ const\ finalBuildOptions\ =\ await\ flatpakBundler.bundle(\{\ //\ Manifest}
\DoxyCodeLine{\ \ \ \ id:\ 'org.world.Hello',}
\DoxyCodeLine{\ \ \ \ base:\ 'io.atom.electron.BaseApp',\ //\ Electron\ base\ application}
\DoxyCodeLine{\ \ \ \ runtime:\ 'org.freedesktop.Platform',\ //\ Use\ the\ freedesktop\ runtime}
\DoxyCodeLine{\ \ \ \ runtimeVersion:\ '1.4',}
\DoxyCodeLine{\ \ \ \ sdk:\ 'org.freedesktop.Sdk',}
\DoxyCodeLine{\ \ \ \ finishArgs:\ [}
\DoxyCodeLine{\ \ \ \ \ \ '-\/-\/share=ipc',\ '-\/-\/socket=x11',\ //\ Allow\ app\ to\ show\ windows\ with\ X11}
\DoxyCodeLine{\ \ \ \ \ \ '-\/-\/socket=pulseaudio',\ //\ Allow\ audio\ output}
\DoxyCodeLine{\ \ \ \ \ \ '-\/-\/filesystem=home',\ //\ Allow\ access\ to\ users\ home\ directory}
\DoxyCodeLine{\ \ \ \ \ \ '-\/-\/share=network',\ //\ Allow\ network\ access}
\DoxyCodeLine{\ \ \ \ \ \ '-\/-\/device=dri'\ //\ Allow\ OpenGL\ rendering}
\DoxyCodeLine{\ \ \ \ ],}
\DoxyCodeLine{\ \ \ \ renameDesktopFile:\ 'hello.desktop',\ //\ Rename\ the\ desktop\ file\ to\ agree\ with\ the\ app\ ID\ so\ flatpak\ will\ export\ it}
\DoxyCodeLine{\ \ \ \ renameIcon:\ 'hello'\ //\ Rename\ the\ icon\ to\ agree\ with\ the\ app\ ID\ so\ flatpak\ will\ export\ it}
\DoxyCodeLine{\ \ \},\ \{\ //\ Build\ options}
\DoxyCodeLine{\ \ \ \ arch:\ 'x86\_64',}
\DoxyCodeLine{\ \ \ \ baseFlatpakref:\ 'https://s3-\/us-\/west-\/2.amazonaws.com/electron-\/flatpak.endlessm.com/electron-\/base-\/app-\/master.flatpakref',\ //\ So\ we\ can\ auto\ install\ the\ runtime}
\DoxyCodeLine{\ \ \ \ bundlePath:\ 'dist/hello\_x86\_64.flatpak',}
\DoxyCodeLine{\ \ \ \ files:\ [}
\DoxyCodeLine{\ \ \ \ \ \ [\ 'static/linux',\ '/share/'\ ],\ //\ Desktop\ file\ and\ icons}
\DoxyCodeLine{\ \ \ \ \ \ [\ packagedFileDir,\ '/share/bar'\ ]\ //\ Application\ binaries\ and\ assets}
\DoxyCodeLine{\ \ \ \ ],}
\DoxyCodeLine{\ \ \ \ gpgSign:\ '1234ABCD',\ //\ GPG\ key\ to\ sign\ with}
\DoxyCodeLine{\ \ \ \ runtimeFlatpakref:\ 'https://raw.githubusercontent.com/endlessm/flatpak-\/bundler/master/refs/freedesktop-\/runtime-\/1.4.flatpakref',}
\DoxyCodeLine{\ \ \ \ symlinks:\ [}
\DoxyCodeLine{\ \ \ \ \ \ [\ '/share/bar/Bar',\ '/bin/Bar'\ ]\ //\ Create\ a\ symlink\ in\ /bin\ to\ to\ app\ executable}
\DoxyCodeLine{\ \ \ \ ]}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ console.log('Flatpak\ built\ successfully.')}
\DoxyCodeLine{\ \ console.log(`Build\ dir\ and\ repo\ in\ \$\{finalBuildOptions.workingDir\}`)}
\DoxyCodeLine{\}\ catch\ (error)\ \{}
\DoxyCodeLine{\ \ console.error('Error\ building\ flatpak',\ error)}
\DoxyCodeLine{\}}

\end{DoxyCode}
 